/*!
 * maptalks.odline v0.4.1
 * LICENSE : MIT
 * (c) 2016-2017 maptalks.org
 */
/*!
 * requires maptalks@>=0.32.0 
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("maptalks")):"function"==typeof define&&define.amd?define(["exports","maptalks"],e):e(t.maptalks=t.maptalks||{},t.maptalks)}(this,function(t,e){"use strict";function i(t,e){for(var i=Object.getOwnPropertyNames(e),o=0;o<i.length;o++){var n=i[o],a=Object.getOwnPropertyDescriptor(e,n);a&&a.configurable&&void 0===t[n]&&Object.defineProperty(t,n,a)}return t}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):i(t,e))}function r(t,e,i,o){var n=1-o;return n*(n*t+2*o*e)+o*o*i}var s={lineColor:"#000",lineWidth:2},p=function(t){function i(e,a,r){o(this,i),a&&!Array.isArray(a)&&(a=[a]);var s=n(this,t.call(this,e,r));return s.setData(a),s}return a(i,t),i.prototype.getData=function(){return this._data},i.prototype.setData=function(t){return this._data=t,delete this._endEventFired,this.getMap()&&(this._prepareData(),this._getRenderer()&&this._getRenderer().render()),this},i.prototype.identify=function(){return null},i.prototype.getParticles=function(t){this._animStartTime||(this._animStartTime=Date.now());var i=this.getMap(),o=i.getScale(),n=t-this._animStartTime,a=this.options.animationDuration;if(this.options.animationOnce&&n>a)return this._endEventFired||(this._endEventFired=!0,this.fire("animateend")),[];for(var p=this.options.symbol||s,d=n%a/a,l=[],h=void 0,u=void 0,c=void 0,f=void 0,y=void 0,m=void 0,_=void 0,v=0,g=this._dataToDraw.length;v<g;v++)this.options.animationRandom&&(d=(t-this._animStartTime-this._dataToDraw[v].time)%a/a)<0&&(d=0),d>0&&(h=this._dataToDraw[v].points,f=this._data[v].symbol||p,y=h[0],m=h[1],h[2]?(_=h[2],u=r(y.x,_.x,m.x,d),c=r(y.y,_.y,m.y,d)):(u=y.x+d*(m.x-y.x),c=y.y+d*(m.y-y.y)),l.push({point:i._pointToContainerPoint(new e.Point(u,c)._multi(1/o)),r:(f.lineWidth||3)/2,color:f.lineColor}));return l},i.prototype.draw=function(e){return this._dataToDraw||this._prepareData(),this.options.animation?t.prototype.draw.apply(this,arguments):(this._drawLines(e),this)},i.prototype.onConfig=function(){this._getRenderer()&&this._getRenderer().render()},i.prototype.onRemove=function(){delete this._dataToDraw},i.prototype.toJSON=function(t){t||(t={});var i={type:this.getJSONType(),id:this.getId(),options:this.config()},o=this.getData();if(t.clipExtent){for(var n=new e.Extent(t.clipExtent),a=[],r=0,s=o.length;r<s;r++)n.contains(new e.Coordinate(o[r][0],o[r][1]))&&a.push(o[r]);i.data=a}else i.data=o;return i},i.fromJSON=function(t){return t&&t.type===this.getJSONType()?new i(t.id,t.data,t.options):null},i.prototype._precise=function(t){return e.Util.round(100*t)/100},i.prototype._drawLines=function(t){if(this._dataToDraw){var e=this.getMap(),i=e.getScale(),o={},n=this.options.symbol||s,a=void 0,r=void 0,p=void 0,d=void 0,l=void 0;t.lineCap="round";for(var h=0,u=this._dataToDraw.length;h<u;h++)a=this._dataToDraw[h].points,r=this._data[h].symbol||o,t.strokeStyle=r.lineColor||n.lineColor||"rgba(255, 255, 255, 0.01)",t.lineWidth=r.lineWidth||n.lineWidth||1,t.beginPath(),p=e._pointToContainerPoint(a[0].multi(1/i)),t.moveTo(p.x,p.y),d=e._pointToContainerPoint(a[1].multi(1/i)),a[2]?(l=e._pointToContainerPoint(a[2].multi(1/i)),t.quadraticCurveTo(l.x,l.y,d.x,d.y)):t.lineTo(d.x,d.y),t.stroke()}},i.prototype._prepareData=function(){if(this._data){for(var t=this.options.curveness,i=this.getMap(),o=i.getMaxNativeZoom(),n=[],a=void 0,r=void 0,s=0,p=this._data.length;s<p;s++){var d=[a=i.coordinateToPoint(new e.Coordinate(this._data[s].coordinates[0]),o),r=i.coordinateToPoint(new e.Coordinate(this._data[s].coordinates[1]),o)];if(t){var l=r.distanceTo(a),h=a.substract(r)._unit()._perp(),u=a.add(r)._multi(.5),c=t*l,f=new e.Point(u.x+c*h.x,u.y+c*h.y);d.push(f)}n.push({points:d,time:Math.random()*this.options.animationDuration})}this._dataToDraw=n}},i}(e.ParticleLayer);p.mergeOptions({animation:!1,animationOnce:!1,animationDuration:6e3,animationRandom:!1,curveness:0,trail:20,globalCompositeOperation:"lighter"}),p.registerJSONType("ODLineLayer"),t.ODLineLayer=p,Object.defineProperty(t,"__esModule",{value:!0}),"undefined"!=typeof console&&console.log("maptalks.odline v0.4.1, requires maptalks@>=0.32.0.")});